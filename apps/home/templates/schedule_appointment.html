{% extends 'navbar.html' %}
{% load bootstrap5 %} <!-- Load the bootstrap5 template tag library -->
{% bootstrap_css %} <!-- Load the Bootstrap CSS img folder -->
{% bootstrap_javascript %} <!-- Load the Bootstrap JavaScript img folder -->
{% bootstrap_messages %} <!--Optional: Display django.contrib.messages as Bootstrap alerts -->
{% load static %} <!--Load files stored in static folder in app folder-->

<head>
  <!-- Link to your custom CSS file -->
  <link rel="stylesheet" href="{% static 'css/discountModal.css' %}">
</head>

{% block content %}
<style>
    .form-container {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .hidden-content {
        display: none;
    }

    .form-container iframe {
        width: 100%; 
        height: 100%; 
        border: none;
    }

    .iframe-container {
        padding: 20px;
        background-color: var(--card-bg-color);
        border-radius: 10px;
    }
</style>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<!-- CAPTCHA Form (Initially Visible) -->
<form class="form-container" id="captcha-form" method="POST">
    {% csrf_token %}
    <div class="g-recaptcha" data-sitekey="6Lej8OIqAAAAAKsZ6a_qsKn4fJA8zzz3_KFAczql" data-callback="showContent"></div>
</form>

<!-- Services List with Checkboxes (Initially Hidden) -->
<div class="container my-5 shadow-lg hidden-content" id="services-container">
  <div class="row">
    <script src="{% static 'js/costCalculator.js' %}"></script>
    <div class="card shadow-lg">
      <div class="card-header text-center fs-1">
        Services Calculator
      </div>
      <div class="card-body">
        <p class="card-text text-center">Calculate your possible costs before coming in or making an appointment.</p>
        <h6 class="card-subtitle mb-2 text-muted fw-bold text-center">NOTE: This is NOT an official receipt or estimate!</h6>
        <form id="services-form">
          <table class="table">
            <thead>
              <tr>
                <th scope="col"></th>
                <th scope="col">Service</th>
                <th scope="col">Cost</th>
                <th scope="col">Time to Complete</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              {% for service in services %}
              <tr>
                <th scope="row" class="text-center">
                  <div class="form-check">
                    <input class="form-check-input service-checkbox" type="checkbox" value="{{ service.cost }}" data-time="{{ service.time_to_complete }}" id="service{{ service.id }}" style="transform: scale(2);">
                  </div>
                </th>
                <label class="form-check-label text-center" for="service{{ service.id }}"></label>
                  <td>{{ service.name }}</td>
                  <td>${{ service.cost }}</td>
                  <td>{{ service.time_to_complete }}</td>
                  <td>
                    <div class="text-left">
                        <button class="btn btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ service.id }}" aria-expanded="false" aria-controls="collapse{{ service.id }}" {% if not service.description %}disabled{% endif %}>
                        &#10597; Click for Description &#10597;
                        </button>
                    </div>
                  </td>
                </label>
              </tr>
              <tr class="collapse" id="collapse{{ service.id }}">
                <td colspan="5">
                  <div class="card card-body">
                    {{ service.description }}
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </form>
      </div>
      <div class="card-footer">        
        <div class="row">
          <div class="col-sm-6">
            <div class="card">
              <div class="card-body text-center">
                <h5 class="card-title text-center">Total Cost:</h5>
                Roughly $<span id="total-cost">0.00</span> total.
              </div>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="card">
              <div class="card-body text-center">
                <h5 class="card-title text-center">Total Time</h5>
                Roughly <span id="total-time">0.00</span> hours.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- end Services List with Checkboxes -->

<!-- Google Calendar Appointment Scheduling (Initially Hidden) -->
<div class="container my-5 shadow-lg hidden-content" id="calendar-container">
  <div class="row">
    <div class="iframe-container" style="padding: 20px; background-color: var(--card-bg-color); border-radius: 10px;">
      <iframe src="https://calendar.google.com/calendar/appointments/schedules/AcZssZ2IiQ_sRU3H1Z6p1DZyJhyg1ITZ_dHFNViptvAEMSJHYlYpElLic4ZYSI6tZ0e3y0HEzddazHkp?gv=true" 
        style="border: 0; width: 100%; height: 800px; border-radius: 8px;" 
        frameborder="0">
      </iframe>
    </div>
  </div>
</div>
<!-- end Services List with Checkboxes -->

<!-- Discount Modal -->
<div class="modal fade discount-modal" id="discountModal" tabindex="-1" aria-labelledby="discountModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="discountModalLabel">Limited Time Promotion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Get <strong>5% off</strong> your service when you schedule an appointment for the first time!
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Awesome, Let's Go!</button>
      </div>
    </div>
  </div>
</div>

<!-- Include discount modal JavaScript -->
<script src="{% static 'js/discountModal.js' %}"></script>

{% include 'footer.html' %}

<script>
    // This function will be triggered when CAPTCHA is solved
    function showContent() {
        console.log("CAPTCHA solved, showing the services and calendar.");

        document.getElementById('services-container').classList.remove('hidden-content');
        document.getElementById('calendar-container').classList.remove('hidden-content');

        // Hide the CAPTCHA form
        document.getElementById('captcha-form').classList.add('hidden-content');
    }
</script>

{% endblock %}